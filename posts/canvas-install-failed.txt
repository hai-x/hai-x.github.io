1:HL["/_next/static/media/a34f9d1faa5f3315-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/2eb10676cf259d3f.css","style",{"crossOrigin":""}]
0:["PWEdH4xjP9aCV2hKPEY47",[[["",{"children":["posts",{"children":[["slug","canvas-install-failed","c"],{"children":["__PAGE__?{\"slug\":[\"canvas-install-failed\"]}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2eb10676cf259d3f.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:I[4336,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],"ThemeProvider"]
6:I[3386,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],""]
7:I[6039,["39","static/chunks/39-cefea7e4f434356b.js","931","static/chunks/app/page-401250cce1be0565.js"],""]
8:I[1974,[],""]
9:I[6496,[],""]
3:[null,["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","title",null,{"children":"hai-x"}],["$","body",null,{"children":["$","$L5",null,{"attribute":"class","children":["$","div",null,{"className":"antialiased min-h-screen bg-white text-slate-900 __className_d65c78","children":["$","div",null,{"className":"max-w-2xl mx-auto py-10 px-4","children":[["$","header",null,{"children":["$","div",null,{"className":"flex items-center justify-between","children":[["$","$L6",null,{}],["$","nav",null,{"className":"ml-auto text-sm font-medium space-x-6","children":[["$","$L7",null,{"href":"/","children":"Home"}],["$","$L7",null,{"href":"/about","children":"About"}]]}]]}]}],["$","main",null,{"children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","canvas-install-failed","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"slug\":[\"canvas-install-failed\"]}"},"styles":[]}],"segment":["slug","canvas-install-failed","c"]},"styles":[]}],"segment":"posts"},"styles":[]}]}],["$","footer",null,{"className":"mt-8","children":[["$","hr",null,{"className":"my-4"}],["$","small",null,{"className":"flex justify-end ","children":["$","nav",null,{"className":"underline decoration-1","children":[["$","$L7",null,{"href":"https://github.com/hai-x","className":"mr-3","children":"@github"}],["$","$L7",null,{"href":"https://twitter.com/__haijie","children":"@twitter"}]]}]}]]}]]}]}]}]}]]}],null]
4:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Troubleshoot/canvas@2.6.1 install failed"}],["$","meta","2",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","3",{"name":"next-size-adjust"}]]
b:["$","article",null,{"className":"py-6 prose dark:prose-invert","children":[["$","h1",null,{"className":"mb-4 break-all","children":"Troubleshoot/canvas@2.6.1 install failed"}],"$undefined",["$","hr",null,{"className":"my-6"}],[["$","p",null,{"children":["Our project depends on ",["$","code",null,{"children":"fabric@3.6.3"}]," who depends on ",["$","code",null,{"children":"canvas@2.6.1"}],"."]}],"\n",["$","p",null,{"children":"Since upgrading to macos@15.2, its installation never succeeded. Let to understand the entire installation process."}],"\n",["$","p",null,{"children":["When install ",["$","code",null,{"children":"canvas"}],", ",["$","a",null,{"href":"https://github.com/mapbox/node-pre-gyp/blob/bd7cf6921c81870647a27405f83558b91e9496f6/lib/install.js#L215","children":[["$","code",null,{"children":"node-pre-gyp"}]," will be executed to install its binary module from whether local cache or remote."]}]]}],"\n",["$","p",null,{"children":["For remote prebuilt binary downloading, ",["$","code",null,{"children":"node-pre-gyp"}]," will produce download url by node-abi version. (generally it determined by ",["$","code",null,{"children":"node.js"}]," version)"]}],"\n",["$","p",null,{"children":["The prebuilt binary version of ",["$","code",null,{"children":"canvas@2.6.1"}]," is up to node-abi v88, that is, canvas-v2.6.1-node-v88-xxx.tar.gz."]}],"\n",["$","p",null,{"children":"But in node v18.15.0, the version of node-abi is v108. So we can't consume the prebuilt binary module and need build it by node-gyp locally."}],"\n",["$","p",null,{"children":"Following is the version list of related libs:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"node@18.15.0"}],"\n",["$","li",null,{"children":"node-gyp@9.3.1"}],"\n",["$","li",null,{"children":"node-pre-gyp@0.11.0"}],"\n"]}],"\n",["$","p",null,{"children":["Then, following ",["$","a",null,{"href":"https://github.com/Automattic/node-canvas/wiki/Installation:-Mac-OS-X","children":"the guide of installation from official github repo"}],"."]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":["\n",["$","pre",null,{"children":["$","code",null,{"className":"language-bash","children":"brew install pkg-config cairo pango libpng jpeg giflib librsvg.\n"}]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":["If you cannot find ",["$","code",null,{"children":"cairo"}]," brew formula, do ",["$","code",null,{"children":"brew update-reset"}]," to update brew."]}],"\n",["$","ol",null,{"start":"2","children":["\n",["$","li",null,{"children":"Check your python3 version. node-gyp >= v10 requires Python 3.12."}],"\n"]}],"\n",["$","p",null,{"children":["For node-gyp@9.3.1, ",["$","a",null,{"href":"https://github.com/nodejs/node-gyp/issues/2992#issuecomment-2038056234","children":"you need upgrade to node-gyp@10 or downgrade to python@3.11"}],"."]}],"\n",["$","p",null,{"children":"So maybe you want to download python@3.11. do"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-bash","children":" brew install python@3.11\n brew uninstall --ignore-dependencies python@3.13\n"}]}],"\n",["$","ol",null,{"start":"3","children":["\n",["$","li",null,{"children":["Run ",["$","code",null,{"children":"yarn"}]," again."]}],"\n"]}],"\n",["$","p",null,{"children":["If it still emits error that ",["$","code",null,{"children":"../src/CanvasRenderingContext2d.cc:7:10: fatal error: 'cairo/cairo-pdf.h' file not found#include <cairo/cairo-pdf.h>"}],", you need to include header file from homebrew."]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-bash","children":"CPLUS_INCLUDE_PATH=/opt/homebrew/include yarn\n"}]}],"\n",["$","ol",null,{"start":"4","children":["\n",["$","li",null,{"children":["Wait to see ",["$","code",null,{"children":"Done in ..s"}]," successfully."]}],"\n"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-bash","children":"[4/4] ðŸ”¨ Building fresh packages...\nâœ¨ Done in 28.45s.\n"}]}]]]}]
a:null
