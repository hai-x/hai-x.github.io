<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/2eb10676cf259d3f.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-43c42d52cdb06b2d.js" crossorigin=""/><script src="/_next/static/chunks/9a28f2a4-325006bed6c0406c.js" async="" crossorigin=""></script><script src="/_next/static/chunks/748-a46810dc8bd60d1b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-3645b298c4863d62.js" async="" crossorigin=""></script><script src="/_next/static/chunks/39-cefea7e4f434356b.js" async=""></script><script src="/_next/static/chunks/app/layout-2a9799121329ca53.js" async=""></script><script src="/_next/static/chunks/app/page-401250cce1be0565.js" async=""></script><title>Troubleshoot/canvas@2.6.1 install failed</title><meta name="next-size-adjust"/><title>hai-x</title><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><script>((e,t,r,a,o,l,u,i)=>{let s=document.documentElement,c=["light","dark"];function p(t){(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,a=r&&l?o.map(e=>l[e]||e):o;r?(s.classList.remove(...a),s.classList.add(t)):s.setAttribute(e,t)}),i&&c.includes(t)&&(s.style.colorScheme=t)}if(a)p(a);else try{let e=localStorage.getItem(t)||r,a=u&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;p(a)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="antialiased min-h-screen bg-white text-slate-900 __className_d65c78"><div class="max-w-2xl mx-auto py-10 px-4"><header><div class="flex items-center justify-between"><div class="w-6 h-6"></div><nav class="ml-auto text-sm font-medium space-x-6"><a href="/">Home</a><a href="/about">About</a></nav></div></header><main><article class="py-6 prose dark:prose-invert"><h1 class="mb-4 break-all">Troubleshoot/canvas@2.6.1 install failed</h1><hr class="my-6"/><p>Our project depends on <code>fabric@3.6.3</code> who depends on <code>canvas@2.6.1</code>.</p>
<p>Since upgrading to macos@15.2, its installation never succeeded. Let to understand the entire installation process.</p>
<p>When install <code>canvas</code>, <a href="https://github.com/mapbox/node-pre-gyp/blob/bd7cf6921c81870647a27405f83558b91e9496f6/lib/install.js#L215"><code>node-pre-gyp</code> will be executed to install its binary module from whether local cache or remote.</a></p>
<p>For remote prebuilt binary downloading, <code>node-pre-gyp</code> will produce download url by node-abi version. (generally it determined by <code>node.js</code> version)</p>
<p>The prebuilt binary version of <code>canvas@2.6.1</code> is up to node-abi v88, that is, canvas-v2.6.1-node-v88-xxx.tar.gz.</p>
<p>But in node v18.15.0, the version of node-abi is v108. So we can&#x27;t consume the prebuilt binary module and need build it by node-gyp locally.</p>
<p>Following is the version list of related libs:</p>
<ul>
<li>node@18.15.0</li>
<li>node-gyp@9.3.1</li>
<li>node-pre-gyp@0.11.0</li>
</ul>
<p>Then, following <a href="https://github.com/Automattic/node-canvas/wiki/Installation:-Mac-OS-X">the guide of installation from official github repo</a>.</p>
<ol>
<li>
<pre><code class="language-bash">brew install pkg-config cairo pango libpng jpeg giflib librsvg.
</code></pre>
</li>
</ol>
<p>If you cannot find <code>cairo</code> brew formula, do <code>brew update-reset</code> to update brew.</p>
<ol start="2">
<li>Check your python3 version. node-gyp &gt;= v10 requires Python 3.12.</li>
</ol>
<p>For node-gyp@9.3.1, <a href="https://github.com/nodejs/node-gyp/issues/2992#issuecomment-2038056234">you need upgrade to node-gyp@10 or downgrade to python@3.11</a>.</p>
<p>So maybe you want to download python@3.11. do</p>
<pre><code class="language-bash"> brew install python@3.11
 brew uninstall --ignore-dependencies python@3.13
</code></pre>
<ol start="3">
<li>Run <code>yarn</code> again.</li>
</ol>
<p>If it still emits error that <code>../src/CanvasRenderingContext2d.cc:7:10: fatal error: &#x27;cairo/cairo-pdf.h&#x27; file not found#include &lt;cairo/cairo-pdf.h&gt;</code>, you need to include header file from homebrew.</p>
<pre><code class="language-bash">CPLUS_INCLUDE_PATH=/opt/homebrew/include yarn
</code></pre>
<ol start="4">
<li>Wait to see <code>Done in ..s</code> successfully.</li>
</ol>
<pre><code class="language-bash">[4/4] ðŸ”¨ Building fresh packages...
âœ¨ Done in 28.45s.
</code></pre></article></main><footer class="mt-8"><hr class="my-4"/><small class="flex justify-end "><nav class="underline decoration-1"><a class="mr-3" href="https://github.com/hai-x">@github</a><a href="https://twitter.com/__haijie">@twitter</a></nav></small></footer></div></div><script src="/_next/static/chunks/webpack-43c42d52cdb06b2d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/2eb10676cf259d3f.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:I[2478,[],\"\"]\n6:I[2280,[],\"\"]\n7:I[4336,[\"39\",\"static/chunks/39-cefea7e4f434356b.js\",\"185\",\"static/chunks/app/layout-2a9799121329ca53.js\"],\"ThemeProvider\"]\n8:I[3386,[\"39\",\"static/chunks/39-cefea7e4f434356b.js\",\"185\",\"static/chunks/app/layout-2a9799121329ca53.js\"],\"\"]\n9:I[6039,[\"39\",\"static/chunks/39-cefea7e4f434356b.js\",\"931\",\"static/chunks/app/page-401250cce1be0565.js\"],\"\"]\na:I[1974,[],\"\"]\nb:I[6496,[],\"\"]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2eb10676cf259d3f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"PWEdH4xjP9aCV2hKPEY47\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/canvas-install-failed\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"canvas-install-failed\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"canvas-install-failed\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"title\",null,{\"children\":\"hai-x\"}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L7\",null,{\"attribute\":\"class\",\"children\":[\"$\",\"div\",null,{\"className\":\"antialiased min-h-screen bg-white text-slate-900 __className_d65c78\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[[\"$\",\"$L8\",null,{}],[\"$\",\"nav\",null,{\"className\":\"ml-auto text-sm font-medium space-x-6\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"canvas-install-failed\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lc\",\"$Ld\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"canvas-install-failed\\\"]}\"},\"styles\":[]}],\"segment\":[\"slug\",\"canvas-install-failed\",\"c\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"mt-8\",\"children\":[[\"$\",\"hr\",null,{\"className\":\"my-4\"}],[\"$\",\"small\",null,{\"className\":\"flex justify-end \",\"children\":[\"$\",\"nav\",null,{\"className\":\"underline decoration-1\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"https://github.com/hai-x\",\"className\":\"mr-3\",\"children\":\"@github\"}],[\"$\",\"$L9\",null,{\"href\":\"https://twitter.com/__haijie\",\"children\":\"@twitter\"}]]}]}]]}]]}]}]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"article\",null,{\"className\":\"py-6 prose dark:prose-invert\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-4 break-all\",\"children\":\"Troubleshoot/canvas@2.6.1 install failed\"}],\"$undefined\",[\"$\",\"hr\",null,{\"className\":\"my-6\"}],[[\"$\",\"p\",null,{\"children\":[\"Our project depends on \",[\"$\",\"code\",null,{\"children\":\"fabric@3.6.3\"}],\" who depends on \",[\"$\",\"code\",null,{\"children\":\"canvas@2.6.1\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Since upgrading to macos@15.2, its installation never succeeded. Let to understand the entire installation process.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When install \",[\"$\",\"code\",null,{\"children\":\"canvas\"}],\", \",[\"$\",\"a\",null,{\"href\":\"https://github.com/mapbox/node-pre-gyp/blob/bd7cf6921c81870647a27405f83558b91e9496f6/lib/install.js#L215\",\"children\":[[\"$\",\"code\",null,{\"children\":\"node-pre-gyp\"}],\" will be executed to install its binary module from whether local cache or remote.\"]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For remote prebuilt binary downloading, \",[\"$\",\"code\",null,{\"children\":\"node-pre-gyp\"}],\" will produce download url by node-abi version. (generally it determined by \",[\"$\",\"code\",null,{\"children\":\"node.js\"}],\" version)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The prebuilt binary version of \",[\"$\",\"code\",null,{\"children\":\"canvas@2.6.1\"}],\" is up to node-abi v88, that is, canvas-v2.6.1-node-v88-xxx.tar.gz.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But in node v18.15.0, the version of node-abi is v108. So we can't consume the prebuilt binary module and need build it by node-gyp locally.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Following is the version list of related libs:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"node@18.15.0\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"node-gyp@9.3.1\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"node-pre-gyp@0.11.0\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Then, following \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Automattic/node-canvas/wiki/Installation:-Mac-OS-X\",\"children\":\"the guide of installation from official github repo\"}],\".\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"brew install pkg-config cairo pango libpng jpeg giflib librsvg.\\n\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you cannot find \",[\"$\",\"code\",null,{\"children\":\"cairo\"}],\" brew formula, do \",[\"$\",\"code\",null,{\"children\":\"brew update-reset\"}],\" to update brew.\"]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Check your python3 version. node-gyp \u003e= v10 requires Python 3.12.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For node-gyp@9.3.1, \",[\"$\",\"a\",null,{\"href\":\"https://github.com/nodejs/node-gyp/issues/2992#issuecomment-2038056234\",\"children\":\"you need upgrade to node-gyp@10 or downgrade to python@3.11\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"So maybe you want to download python@3.11. do\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\" brew install python@3.11\\n brew uninstall --ignore-dependencies python@3.13\\n\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"3\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Run \",[\"$\",\"code\",null,{\"children\":\"yarn\"}],\" again.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If it still emits error that \",[\"$\",\"code\",null,{\"children\":\"../src/CanvasRenderingContext2d.cc:7:10: fatal error: 'cairo/cairo-pdf.h' file not found#include \u003ccairo/cairo-pdf.h\u003e\"}],\", you need to include header file from homebrew.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"CPLUS_INCLUDE_PATH=/opt/homebrew/include yarn\\n\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"4\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Wait to see \",[\"$\",\"code\",null,{\"children\":\"Done in ..s\"}],\" successfully.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"[4/4] ðŸ”¨ Building fresh packages...\\nâœ¨ Done in 28.45s.\\n\"}]}]]]}]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Troubleshoot/canvas@2.6.1 install failed\"}],[\"$\",\"meta\",\"2\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"3\",{\"name\":\"next-size-adjust\"}]]\nc:null\n"])</script></body></html>