1:HL["/_next/static/media/a34f9d1faa5f3315-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/2eb10676cf259d3f.css","style",{"crossOrigin":""}]
0:["PWEdH4xjP9aCV2hKPEY47",[[["",{"children":["posts",{"children":[["slug","microApp-render-realize","c"],{"children":["__PAGE__?{\"slug\":[\"microApp-render-realize\"]}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2eb10676cf259d3f.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:I[4336,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],"ThemeProvider"]
6:I[3386,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],""]
7:I[6039,["39","static/chunks/39-cefea7e4f434356b.js","931","static/chunks/app/page-401250cce1be0565.js"],""]
8:I[1974,[],""]
9:I[6496,[],""]
3:[null,["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","title",null,{"children":"hai-x"}],["$","body",null,{"children":["$","$L5",null,{"attribute":"class","children":["$","div",null,{"className":"antialiased min-h-screen bg-white text-slate-900 __className_d65c78","children":["$","div",null,{"className":"max-w-2xl mx-auto py-10 px-4","children":[["$","header",null,{"children":["$","div",null,{"className":"flex items-center justify-between","children":[["$","$L6",null,{}],["$","nav",null,{"className":"ml-auto text-sm font-medium space-x-6","children":[["$","$L7",null,{"href":"/","children":"Home"}],["$","$L7",null,{"href":"/about","children":"About"}]]}]]}]}],["$","main",null,{"children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","microApp-render-realize","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"slug\":[\"microApp-render-realize\"]}"},"styles":[]}],"segment":["slug","microApp-render-realize","c"]},"styles":[]}],"segment":"posts"},"styles":[]}]}],["$","footer",null,{"className":"mt-8","children":[["$","hr",null,{"className":"my-4"}],["$","small",null,{"className":"flex justify-end ","children":["$","nav",null,{"className":"underline decoration-1","children":[["$","$L7",null,{"href":"https://github.com/hai-x","className":"mr-3","children":"@github"}],["$","$L7",null,{"href":"https://twitter.com/__haijie","children":"@twitter"}]]}]}]]}]]}]}]}]}]]}],null]
4:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"MicroFrontEnd - realize MicroApp render"}],["$","meta","2",{"name":"description","content":"Realize MicroApp render by web component"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","4",{"name":"next-size-adjust"}]]
c:T4e7,import { fetchHtml, executeScript } from './fetch.mjs'

class microApp extends HTMLElement {
  // å­åº”ç”¨æ¿€æ´»url
  get activeUrl() {
    return this.getAttribute('active-url')
  }
  // éœ€è¦è¢«ç›‘å¬çš„å±æ€§æ”¾åœ¨è¿™é‡Œå®šä¹‰
  static get observedAttributes() {
    // return ['name']
  }
  get container() {
    return this.shadowRoot
  }
  constructor() {
    super()
  }
  // ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š componentè¢«æ’å…¥domä¸­è§¦å‘
  async connectedCallback() {
    // æ³¨æ„:getAttributeåªèƒ½åœ¨è¿™æ—¶å€™æ‹¿åˆ°
    // this.activeUrl = this.getAttribute("active-url");
    const temp = await this.load()
    this.bootstrap(temp)
    Promise.resolve().then(() => {
      this.mount()
    })
  }
  // åŠ è½½èµ„æº
  async load() {
    const temp = await fetchHtml(this.activeUrl)
    return temp
  }
  // åˆå§‹åŒ–å­åº”ç”¨
  bootstrap(temp) {
    // åˆ›å»ºæ–‡æ¡£ç‰‡æ®µæ’å…¥ç»„ä»¶ä¸­
    const template = document.createElement('template')
    template.innerHTML = temp
    const fra = document.createDocumentFragment()
    fra.appendChild(template.content.cloneNode(true))
    this.appendChild(fra)
  }
  // æŒ‚è½½å­åº”ç”¨
  mount() {
    // æ‰§è¡Œç›¸å…³script
    executeScript(document)
  }
}
window.customElements.define('micro-app', microApp)
d:T563,// ä¿å­˜scriptè„šæœ¬
const sourceSet = new Set()

// å°è£…è¯·æ±‚èµ„æº
async function fetchResource(url) {
  const res = await fetch(url)
  // res.text ä¹Ÿæ˜¯ä¸€ä¸ªpromise
  return res.text()
}

// è¯·æ±‚htmlæ–‡ä»¶
export async function fetchHtml(url) {
  let template = await fetchResource(url)
  return resolveScript(template, url)
}

// å¯¹htmlæºç è¿›è¡Œå¤„ç†
export function resolveScript(template, activeUrl) {
  return template
    .replace(/<head[^>]*>[\s\S]*?<\/head>/i, (match) => {
      return match
        .replace(/<head/i, '<micro-app-head')
        .replace(/<\/head>/i, '</micro-app-head>')
    })
    .replace(/<body[^>]*>[\s\S]*?<\/body>/i, (match) => {
      return match
        .replace(/<body/i, '<micro-app-body')
        .replace(/<\/body>/i, '</micro-app-body>')
    })
    .replace(/src="(.*?)"/g, (_, text) => {
      sourceSet.add(`${activeUrl}${text}`)
      return `src="${activeUrl}${text}"`
    })
    .replace(/href="(.*?)"/g, (_, text) => {
      return `href="${activeUrl}${text}"`
    })
}

// åŒ…è£…æ‰€æœ‰scriptè„šæœ¬
function getExternalScript() {
  return Promise.all(Array.from(sourceSet).map((url) => fetchResource(url)))
}

// æ‰§è¡Œè„šæœ¬
export async function executeScript(document) {
  const scripts = await getExternalScript()
  scripts.forEach((code) => {
    ;(function (document) {
      eval(code)
    })(document)
  })
}
b:["$","article",null,{"className":"py-6 prose dark:prose-invert","children":[["$","h1",null,{"className":"mb-4 break-all","children":"MicroFrontEnd - realize MicroApp render"}],["$","p",null,{"className":"text-slate-700","children":"Realize MicroApp render by web component"}],["$","hr",null,{"className":"my-6"}],[["$","p",null,{"children":["å…³äºå¾®å‰ç«¯çš„ä¸åŒè§£å†³æ–¹æ¡ˆæ€»ç»“ï¼Œå¯ä»¥ç»“åˆä¸‹æˆ‘ä¹‹å‰çš„æ–‡ç«  ->\n",["$","a",null,{"href":"https://juejin.cn/post/7149531106105098277?share_token=77b5ab8b-e8ba-4538-b983-ad0dd981ef44","children":"ğŸ‘¾ æµ…è°ˆå¾®å‰ç«¯è§£å†³æ–¹æ¡ˆ"}]]}],"\n",["$","h3",null,{"children":"Web Component ä»‹ç»ï¼š"}],"\n",["$","p",null,{"children":"æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æ–°ç‰¹æ€§ CustomElement è‡ªå®šä¹‰ä¸€ä¸ª html æ ‡ç­¾ï¼Œæ¥è¡¨ç¤ºä¸€ä¸ªåŸç”Ÿç»„ä»¶ï¼Œä»¥æ­¤æ¥ä»£æ›¿å¦‚ä»Šæ¡†æ¶ä¸­ Reactã€vue ä¸­çš„ç»„ä»¶ã€‚"}],"\n",["$","h3",null,{"children":"å¦‚ä½•ä½¿ç”¨ï¼Ÿ"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"class microApp extends HTMLElement {\n  constructor() {\n    super()\n  }\n}\n"}]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"window.customElements.define('micro-app', microApp)\n"}]}],"\n",["$","p",null,{"children":"è¿™æ ·æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­å°±å¯ä»¥ä½¿ç”¨äº†ï¼"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"<micro-app></micro-app>\n"}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"æœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ä¸ªåŸç”Ÿç»„ä»¶ä¸æˆ‘ä»¬æ¡†æ¶ä¸­çš„ç»„ä»¶ä¸€æ ·ï¼Œæœ‰ç€è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚"}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"connectedCallbackï¼šå½“ç»„ä»¶è¢«æ’å…¥åˆ°æ–‡æ¡£ä¸­è§¦å‘ï¼Œæœ‰åˆ©äºæˆ‘ä»¬è¿›è¡Œä»£ç åˆå§‹åŒ–ã€‚"}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"disconnectedCallbackï¼šå½“ç»„ä»¶ä»æ–‡æ¡£ä¸­è¢«ç§»é™¤æ—¶è§¦å‘ï¼Œæœ‰åˆ©äºæˆ‘ä»¬è¿›è¡Œä»£ç æ¸…é™¤ã€‚"}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"attributeChangedCallback(attrName, oldVal, newVal)ï¼šå½“ç»„ä»¶ä¸­è®¾ç½®çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜æ›´æ—¶è§¦å‘ï¼Œç»“åˆ observedAttributes å±æ€§ä¸€èµ·ä½¿ç”¨ã€‚"}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"adoptedCallbackï¼šå½“ç»„ä»¶è¢«æ’å…¥åˆ°ä¸€ä¸ªæ–°çš„æ–‡æ¡£ä¸­è§¦å‘ã€‚"}]}],"\n",["$","p",null,{"children":["$","code",null,{"children":"å‚è€ƒMDNä¸­Document.adoptNodeçš„APIä»‹ç»ã€‚"}]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["Document.adoptNode():\nä»å…¶ä»–çš„ document æ–‡æ¡£ä¸­è·å–ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¯¥èŠ‚ç‚¹ä»¥åŠå®ƒçš„å­æ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šä»åŸæ–‡æ¡£åˆ é™¤ (å¦‚æœæœ‰è¿™ä¸ªèŠ‚ç‚¹çš„è¯), å¹¶ä¸”å®ƒçš„",["$","code",null,{"children":"ownerDocument"}],"å±æ€§ä¼šå˜æˆå½“å‰çš„ document æ–‡æ¡£ã€‚ä¹‹åä½ å¯ä»¥æŠŠè¿™ä¸ªèŠ‚ç‚¹æ’å…¥åˆ°å½“å‰æ–‡æ¡£ä¸­ã€‚"]}],"\n"]}],"\n",["$","h4",null,{"children":"æ­¥å…¥æœ¬æ–‡ä¸»é¢˜ï¼šå®ç°ä¸€ä¸ªè¿·ä½ ç‰ˆçš„ microAppã€‚"}],"\n",["$","h3",null,{"children":"microApp æ ¸å¿ƒè¦ç‚¹ï¼šå·§å¦™åˆ©ç”¨ CustomElementï¼Œä½¿ç”¨ htmlEntry+å„ç§éš”ç¦»æœºåˆ¶å®ç°å­åº”ç”¨æŒ‚è½½ã€è¿è¡Œä¸å¸è½½ã€‚"}],"\n",["$","h3",null,{}],"\n",["$","p",null,{"children":"é¦–å…ˆæ€è€ƒï¼Œä¸ºä»€ä¹ˆå¾®å‰ç«¯å’Œ Web Component æ‰¯ä¸Šäº†å…³ç³»ï¼Ÿ"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"å›¾å‡ºè‡ª microApp å®˜ç½‘"}]}],"\n",["$","img",null,{"src":"/assets/microApp-render-realize/img1.webp","alt":"microApp å®˜ç½‘"}],"\n",["$","p",null,{"children":"å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† Web Component åŸç”Ÿç»„ä»¶ç‰¹æ€§ï¼Œæ¥å……å½“ä¸€ä¸ªåŸºåº§åº”ç”¨ä¸å­åº”ç”¨çš„åª’ä»‹ï¼Œå› ä¸ºå…¶å…·æœ‰å¤©ç„¶çš„åŸç”Ÿæ”¯æŒï¼Œå¯ä»¥ç›´æ¥è¢«æ³¨å†Œåœ¨åŸºåº§ä¹‹ä¸­ï¼Œé€šä¿¡ä¹Ÿå˜å¾—ååˆ†è½»æ¾ï¼Œå¤©ç„¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä½¿å¾—å®ƒå¯ä»¥è¿›è¡Œå­åº”ç”¨ä¸åŒçŠ¶æ€çš„æµè½¬æ“ä½œã€‚"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"æœ¬æ–‡ä¸»è¦å®ç°çš„æ˜¯å¯¹äºå­åº”ç”¨çš„æŒ‚è½½æ¸²æŸ“æ“ä½œï¼Œè‡ªç„¶ä½¿ç”¨åˆ°çš„ä¾¿æ˜¯ Web Component çš„ connectedCallback é’©å­ã€‚"}]}],"\n",["$","p",null,{"children":"ä¸‹é¢æ¥çœ‹å…·ä½“å¦‚ä½•å®ç°ï¼Œè¿™è¾¹æˆ‘ä»¬ä½¿ç”¨ html ç¼–å†™åŸºåº§ï¼Œvue3 ç¼–å†™å­åº”ç”¨ã€‚"}],"\n",["$","p",null,{"children":"åŸºåº§ä»£ç å¦‚ä¸‹ï¼š"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆ -Web Component</title>\n</head>\n<script src=\"./index.mjs\" type=\"module\"></script>\n<body>\n    <div>å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆ -Web Component</div>\n    <div>\n      // active-url è¡¨ç¤ºå­åº”ç”¨æ¿€æ´»url\n      <micro-app active-url=\"http://127.0.0.1:8002/\"></micro-app>\n    </div>\n</body>\n</html>\n"}]}],"\n",["$","p",null,{"children":"å­åº”ç”¨ä»£ç å¦‚ä¸‹ï¼š"}],"\n",["$","p",null,{"children":"main.js"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"import { createApp } from 'vue'\nimport App from './App.vue'\nimport ElementPlus from 'element-plus'\nimport 'element-plus/dist/index.css'\n\ncreateApp(App).use(ElementPlus).mount('#app')\n"}]}],"\n",["$","p",null,{"children":"webpack.config.js"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"module.exports = {\n  devServer: {\n    port: 8002,\n    headers: {\n      'Access-Control-Allow-Origin': '*'\n    }\n  }\n}\n"}]}],"\n",["$","p",null,{"children":"microApp ç»„ä»¶ä»£ç ï¼š"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"$c"}]}],"\n",["$","p",null,{"children":"å·¥å…·å‡½æ•°ï¼š"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"$d"}]}],"\n",["$","p",null,{"children":"æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š"}],"\n",["$","img",null,{"src":"/assets/microApp-render-realize/img2.webp","alt":"æœ€ç»ˆæ•ˆæœ"}]]]}]
a:null
