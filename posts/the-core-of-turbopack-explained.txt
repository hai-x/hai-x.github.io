1:HL["/_next/static/media/a34f9d1faa5f3315-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/2eb10676cf259d3f.css","style",{"crossOrigin":""}]
0:["PWEdH4xjP9aCV2hKPEY47",[[["",{"children":["posts",{"children":[["slug","the-core-of-turbopack-explained","c"],{"children":["__PAGE__?{\"slug\":[\"the-core-of-turbopack-explained\"]}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2eb10676cf259d3f.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:I[4336,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],"ThemeProvider"]
6:I[3386,["39","static/chunks/39-cefea7e4f434356b.js","185","static/chunks/app/layout-2a9799121329ca53.js"],""]
7:I[6039,["39","static/chunks/39-cefea7e4f434356b.js","931","static/chunks/app/page-401250cce1be0565.js"],""]
8:I[1974,[],""]
9:I[6496,[],""]
3:[null,["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","title",null,{"children":"hai-x"}],["$","body",null,{"children":["$","$L5",null,{"attribute":"class","children":["$","div",null,{"className":"antialiased min-h-screen bg-white text-slate-900 __className_d65c78","children":["$","div",null,{"className":"max-w-2xl mx-auto py-10 px-4","children":[["$","header",null,{"children":["$","div",null,{"className":"flex items-center justify-between","children":[["$","$L6",null,{}],["$","nav",null,{"className":"ml-auto text-sm font-medium space-x-6","children":[["$","$L7",null,{"href":"/","children":"Home"}],["$","$L7",null,{"href":"/about","children":"About"}]]}]]}]}],["$","main",null,{"children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","the-core-of-turbopack-explained","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"slug\":[\"the-core-of-turbopack-explained\"]}"},"styles":[]}],"segment":["slug","the-core-of-turbopack-explained","c"]},"styles":[]}],"segment":"posts"},"styles":[]}]}],["$","footer",null,{"className":"mt-8","children":[["$","hr",null,{"className":"my-4"}],["$","small",null,{"className":"flex justify-end ","children":["$","nav",null,{"className":"underline decoration-1","children":[["$","$L7",null,{"href":"https://github.com/hai-x","className":"mr-3","children":"@github"}],["$","$L7",null,{"href":"https://twitter.com/__haijie","children":"@twitter"}]]}]}]]}]]}]}]}]}]]}],null]
4:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"The core of Turbopack explained"}],["$","meta","2",{"name":"description","content":"The core of Turbopack explained"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","4",{"name":"next-size-adjust"}]]
c:T530,const main = task('main', () => {
  const baseDir = path.join(process.cwd(), 'demo')
  const outDir = path.join(process.cwd(), 'demo', 'dist')
  const entry = path.join(baseDir, '/index.js')
  const header = path.join(process.cwd(), 'demo', 'header.js')
  copyGraph(baseDir, outDir, entry, header)
  log.enable && printCentered(`ğŸ”¥ğŸ”¥ é¦–æ¬¡æ„å»ºå®Œæˆ ğŸ”¥ğŸ”¥`)
})

// æ„å»ºä¸»æµç¨‹
const copyGraph = task('copyGraph', (baseDir, outDir, entry, header) => {
  const relPath = path.relative(baseDir, entry)
  const output = path.join(outDir, relPath)
  copy(output, header, entry)
  const importers = getImporter(entry)
  if (importers?.length > 0)
    for (const importer of importers) {
      copyGraph(baseDir, outDir, importer, header)
    }
})

// è§£æä¾èµ–æ–‡ä»¶çš„è·¯å¾„
const getImporter = task('getImporter', (entry) => {
  const ast = parse(read(entry), {
    sourceType: 'module',
    ecmaVersion: 'latest'
  })
  return (
    ast.body
      .filter((node) => node.type === 'ImportDeclaration')
      .map((node) => node.source.value)
      .filter((value) => {
        return value.startsWith('./')
      })
      .map((value) => path.join(path.dirname(entry), value)) ?? []
  )
})

// è¾“å‡ºæ„å»ºäº§ç‰©
const copy = task('copy', (output, header, entry) => {
  write(output, read(header) + read(entry))
})
b:["$","article",null,{"className":"py-6 prose dark:prose-invert","children":[["$","h1",null,{"className":"mb-4 break-all","children":"The core of Turbopack explained"}],["$","p",null,{"className":"text-slate-700","children":"The core of Turbopack explained"}],["$","hr",null,{"className":"my-6"}],[["$","h2",null,{"children":"ç®€è¿°"}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["æ¥æºï¼š webpack ä½œè€… Tobias Koppers åœ¨ JS Nation\nJSNation 2023 ä¸Šçš„ coding live ä½œå“\n",["$","a",null,{"href":"https://portal.gitnation.org/contents/the-core-of-turbopack-explained-live-coding","children":"The Core of Turbopack Explained (Live Coding)"}]]}],"\n"]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"ç›®çš„ï¼šè§£å†³ webpack å› å¤§é‡æŸ¥æ‰¾ç¼“å­˜ã€éªŒè¯å¤±æ•ˆç¼“å­˜å¯¼è‡´çš„å¼€é”€è¿‡å¤§é—®é¢˜"}],"\n"]}],"\n",["$","p",null,{"children":"æœ¬æ–‡ç« é€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªæœ€ç®€æ„å»ºè¿‡ç¨‹æ¥åˆæ¢ Turbo Engine çš„ä¸€äº›åŸç†ã€‚"}],"\n",["$","h2",null,{"children":"å¦‚ä½•å·¥ä½œ"}],"\n",["$","p",null,{"children":["Turbo Engine ä¼šå°†æŸäº›åŠŸèƒ½æ ‡è®°ä¸º",["$","em",null,{"children":"To be remember"}],"ã€‚å½“è¿™äº›å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šè®°ä½å®ƒä»¬è¢«è°ƒç”¨çš„å†…å®¹ä»¥åŠå®ƒä»¬è¿”å›çš„å†…å®¹ã€‚ç„¶åå®ƒå°†å…¶ä¿å­˜åœ¨ç¼“å­˜ä¸­ã€‚"]}],"\n",["$","p",null,{"children":"ä¸€ä¸ªç®€å•çš„ bundle è¿‡ç¨‹å¯ä»¥æè¿°ä¸ºè¯»å–æºç ï¼Œå¯¹æºç è¿›è¡Œæ„å»ºï¼Œæ‹¼æ¥æ„å»ºäº§ç‰©å½¢æˆæœ€ç»ˆäº§ç‰© å¦‚ä¸‹æ‰€ç¤º"}],"\n",["$","img",null,{"src":"/assets/the-core-of-turbopack-explained/image.png","alt":"å›¾å‡ºè‡ª Turbopack å®˜ç½‘"}],"\n",["$","p",null,{"children":["ä¿®æ”¹ ",["$","code",null,{"children":"sdk.ts"}]," çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡æ„å»ºï¼Œå†æ¬¡æ‹¼æ¥äº§ç‰©ã€‚æ­¤æ—¶ï¼Œå¯¹äº ",["$","code",null,{"children":"api.ts"}]," æ–‡ä»¶å¹¶æœªæ”¹åŠ¨ï¼Œæˆ‘ä»¬å°†ä»ç¼“å­˜ä¸­è¯»å– ",["$","code",null,{"children":"api.ts"}]," çš„å†…å®¹å†æ‹¼æ¥å³å¯ã€‚ä»è€Œå‡å°‘äº†å¯¹äº ",["$","code",null,{"children":"api.ts"}]," çš„è¯»å–ä¸æ„å»ºäº§ç”Ÿçš„å¼€é”€ã€‚"]}],"\n",["$","img",null,{"src":"/assets/the-core-of-turbopack-explained/image-1.png","alt":"å›¾å‡ºè‡ª Turbopack å®˜ç½‘"}],"\n",["$","p",null,{"children":"å¯¹äºä¸€ä¸ªå…·æœ‰æˆåƒä¸Šç™¾ä¸ªæ–‡ä»¶çš„å·¨åº”ç”¨ï¼Œæ„å»ºå·¥å…·éœ€è¦å¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œè·¯å¾„è§£æã€æ–‡ä»¶è¯»å–ã€æºç æ„å»ºã€‚æ‰€æœ‰å·§ç”¨ç¼“å­˜ï¼ˆè®°ä½æ¯æ¬¡å‡½æ•°çš„è°ƒç”¨ç»“æœï¼‰å°†å¯èŠ‚çœå¤§é‡å¼€é”€ã€‚"}],"\n",["$","p",null,{"children":["è¿™ç§è§£å†³æ–¹æ³•èƒ½è®© ",["$","code",null,{"children":"Turbopack"}]," ä»¥æå¿«çš„é€Ÿåº¦è¿›è¡Œåº”ç”¨ç¨‹åºçš„å¢é‡æ„å»ºï¼Œå½“æ–‡ä»¶æ”¹åŠ¨ï¼Œ",["$","code",null,{"children":"devServer"}]," å°†å¿«é€Ÿæ¥ç®¡å¹¶è¿›è¡Œæ„å»ºå“åº”ã€‚"]}],"\n",["$","h3",null,{"children":"å…³äºç¼“å­˜"}],"\n",["$","p",null,{"children":["Turbo Engine å°†è¿™äº›å†…å­˜ç¼“å­˜åœ¨è¿è¡Œå†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç¡¬ç›˜å†…å­˜ä¸­ï¼Œè¿™æ„å‘³ç€ï¼Œå½“å¯åŠ¨ ",["$","code",null,{"children":"devServer"}]," æ—¶ï¼Œæ„å»ºç¼“å­˜å°†ä¸€ç›´å­˜åœ¨ã€‚ç›´åˆ°å…³é—­/åœæ­¢ ",["$","code",null,{"children":"devServer"}]," æ—¶ï¼Œè¿™äº›å†…å­˜å°†è¢«å›æ”¶ã€‚"]}],"\n",["$","h3",null,{"children":"åŸç†è§£é‡Š"}],"\n",["$","p",null,{"children":"æœ€ç®€æ„å»ºè¿‡ç¨‹"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"è¯»å–å…¥å£æ–‡ä»¶æºç ã€è¯»å–è¢«æ‹¼æ¥çš„æ¨¡å— Header (/*_ @copyright the-core-of-turbopack-explained _/)"}],"\n",["$","li",null,{"children":"æ‹¼æ¥æ„å»ºæ¨¡å—"}],"\n",["$","li",null,{"children":"è¾“å‡ºæ„å»ºäº§ç‰©"}],"\n",["$","li",null,{"children":"è§£æå…¥å£æ–‡ä»¶çš„ä¾èµ–"}],"\n"]}],"\n",["$","p",null,{"children":["ç¬¬ 1,2,3 æ­¥æˆ‘ä»¬ç»Ÿç§°ä¸º ",["$","code",null,{"children":"copy"}]," æ„å»ºé˜¶æ®µï¼Œè€Œåæ‰§è¡Œç¬¬ 4 æ­¥ ",["$","code",null,{"children":"getImporter"}]," æ„å»ºé˜¶æ®µï¼Œå¦‚å‘ç°å­˜åœ¨ä¾èµ–æ–‡ä»¶ï¼Œåˆ™é€’å½’æ‰§è¡Œæ­¤æ„å»ºè¿‡ç¨‹"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"$c"}]}],"\n",["$","p",null,{"children":"æ¯ä¸ªæ„å»ºé˜¶æ®µéƒ½ä½¿ç”¨äº† task å‡½æ•°è¿›è¡ŒåŒ…è£¹ï¼Œè¯¥å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯å¯¹ã€Œç›¸åŒå…¥å‚ä¸å‡½æ•°åã€å‡½æ•°çš„æ‰§è¡Œç»“æœè¿›è¡Œç¼“å­˜ã€‚"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"const taskCache = new TupleMap()\nexport let currentTask = null\n\nexport const task = (name, f) => {\n  return (...args) => {\n    let task = taskCache.get([name, ...args]) ?? null\n    if (!task) {\n      task = {\n        name,\n        args,\n        f,\n        result: undefined,\n        dependentTasks: new Set()\n      }\n      task.result = wrapCurrentTask(task, () => logged(name, f, args))\n      taskCache.set([name, ...args], task)\n    }\n    currentTask && task.dependentTasks.add(currentTask)\n    return task.result\n  }\n}\n"}]}],"\n",["$","h4",null,{"children":"å…³é”®å‡½æ•°ä¸å˜é‡"}],"\n",["$","p",null,{"children":[["$","code",null,{"children":"logged"}]," å‡½æ•°ä»…åšæ—¥å¿—æ‰“ç‚¹ç”¨ï¼Œåœ¨æ­¤ä¸åšè¿‡å¤šè§£é‡Š"]}],"\n",["$","p",null,{"children":[["$","code",null,{"children":"currentTask"}]," å˜é‡ç”¨æ¥è®°å½•å½“å‰æ‰€å¤„å“ªä¸ªæ„å»ºé˜¶æ®µï¼Œä»¥æ–¹ä¾¿è®°å½•å„ä¸ªæ„å»ºé˜¶æ®µä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚"]}],"\n",["$","p",null,{"children":[["$","code",null,{"children":"currentTask"}]," å˜é‡è®°å½•è¿˜ä¾èµ– ",["$","code",null,{"children":"withCurrentTask"}]," æ–¹æ³•ï¼Œå…·ä½“æ“ä½œä¸ºï¼š å½“å‰æ„å»ºé˜¶æ®µçš„å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œä¼šè¿˜åŸ ",["$","code",null,{"children":"currentTask"}]," ä¸ºå…¶çˆ¶çº§æ„å»ºé˜¶æ®µï¼Œç„¶åé€šè¿‡ ",["$","code",null,{"children":"task.dependentTasks.add(currentTask)"}]," æ¥è®°å½•å½“å‰æ„å»ºé˜¶æ®µçš„çˆ¶çº§æ„å»ºé˜¶æ®µã€‚"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"// wrap current task to be able to track dependent tasks\nconst wrapCurrentTask = (task, f) => {\n  const oldTask = currentTask\n  currentTask = task\n  try {\n    return f()\n  } finally {\n    currentTask = oldTask\n  }\n}\n"}]}],"\n",["$","p",null,{"children":"ä¾æ®æ­¤ï¼Œå³å¯æ„å»ºå‡ºä¸€ä¸ªå®Œæ•´çš„ taskCacheï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º"}],"\n",["$","img",null,{"src":"/assets/the-core-of-turbopack-explained/image-2.png","alt":"Task Cache"}],"\n",["$","h4",null,{"children":"ç¼“å­˜èŠ‚ç‚¹å±æ€§è§£é‡Š"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"name: æ„å»ºé˜¶æ®µåï¼ŒMap çš„ key ä¹‹ä¸€"}],"\n",["$","li",null,{"children":"f: æ„å»ºæ‰§è¡Œå‡½æ•°"}],"\n",["$","li",null,{"children":"args: æ‰§è¡Œå‡½æ•°çš„å…¥å‚ï¼ŒMap çš„ key ä¹‹ä¸€"}],"\n",["$","li",null,{"children":"dependentTasks: ä»£è¡¨è¯¥æ„å»ºé˜¶æ®µå‡½æ•°çš„çˆ¶çº§é›†åˆ"}],"\n"]}],"\n",["$","p",null,{"children":["ç°åœ¨æˆ‘ä»¬å·²å®ç°ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œå³å®˜ç½‘ä¸­æåŠçš„ ",["$","a",null,{"href":"https://turbo.build/pack/docs/core-concepts#function-level-caching","children":"Function-level caching"}]]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"å¯¹äºé‡å¤è·¯å¾„çš„æ–‡ä»¶è¯»å–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œä¸ç”¨å†æ¬¡è¯»å–ç¡¬ç›˜æ–‡ä»¶ã€‚"}],"\n",["$","li",null,{"children":"å¯¹äºé‡å¤è·¯å¾„çš„ä¾èµ–æ–‡ä»¶è§£æï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œä¸ç”¨å†æ¬¡ä½¿ç”¨ parser è¿›è¡Œä¾èµ–è§£æã€‚"}],"\n",["$","li",null,{"children":"..."}],"\n"]}],"\n",["$","p",null,{"children":"ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚ä½•åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ”¹åŠ¨ï¼Œä»¥åŠæ–‡ä»¶æ”¹åŠ¨åï¼Œè®©ç¼“å­˜å¤±æ•ˆã€‚"}],"\n",["$","h4",null,{"children":"æ€è€ƒ"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"å¦‚ä½•åˆ¤æ–­æ–‡ä»¶æ”¹åŠ¨ï¼šæˆ‘ä»¬ç®€å•é€šè¿‡ fs æ¨¡å—çš„ watch å‡½æ•°è¿›è¡Œæ–‡ä»¶ç›‘å¬ã€‚"}],"\n",["$","li",null,{"children":"å¦‚ä½•ä½¿ç¼“å­˜å¤±æ•ˆï¼šå½“æ–‡ä»¶æ”¹åŠ¨åï¼Œå†æ¬¡è¿›è¡Œæ–‡ä»¶è¯»å– read å·¥ä½œï¼Œå¹¶ä¸”æ‰§è¡Œå†’æ³¡æ“ä½œï¼Œå³é€’å½’æ‰§è¡Œçˆ¶çº§æ„å»ºé˜¶æ®µçš„å‡½æ•°ï¼ŒgetImporter, write...ï¼ŒåŒæ—¶è¿›è¡Œç¼“å­˜çš„æ›´æ–°ã€‚"}],"\n"]}],"\n",["$","h4",null,{"children":"å¦‚ä½•å®ç°"}],"\n",["$","p",null,{"children":["å…ˆåˆ›å»ºä¸€ä¸ªç¼“å­˜å¤±æ•ˆå‡½æ•°ï¼Œç›®çš„æ˜¯é‡æ–°æ‰§è¡Œ read å‡½æ•°é˜¶æ®µï¼Œä½¿ç¼“å­˜å¤±æ•ˆï¼Œæ›´æ–° ",["$","code",null,{"children":"task.result"}],"ï¼Œå¦‚æœ task.result å‘ç”Ÿå˜åŒ–ï¼Œåˆ™é€’å½’æ‰§è¡Œçˆ¶çº§æ„å»ºé˜¶æ®µçš„å‡½æ•°ã€‚"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"export const invalidate = (task) => {\n  const oldTaskResult = task.result\n  // recalculate task\n  logged(\n    task.name,\n    () => {\n      task.result = wrapCurrentTask(task, () => {\n        return task.f(...task.args)\n      })\n    },\n    task.args\n  )\n  // invalidate dependent tasks\n  if (JSON.stringify(oldTaskResult) !== JSON.stringify(task.result)) {\n    if (task.dependentTasks.size > 0) {\n      for (const dependentTask of task.dependentTasks) {\n        invalidate(dependentTask)\n      }\n    }\n  } else {\n    log.enable && printCentered(`ğŸ”¥ğŸ”¥ ${task.name} no change ğŸ”¥ğŸ”¥`)\n  }\n}\n"}]}],"\n",["$","p",null,{"children":["å°† ",["$","code",null,{"children":"currentTask"}]," ä½œä¸ºå…¥å‚ä¼ å…¥ ",["$","code",null,{"children":"invalidate"}]," ç¼“å­˜å¤±æ•ˆå‡½æ•°ä¸­ï¼Œå³å¯æ˜ç¡® è¯¥å…¥å£æ–‡ä»¶ & è¯¥æ„å»ºé˜¶æ®µ çš„çˆ¶çº§æ„å»ºé“¾ï¼Œä»è€Œå®ç°å†’æ³¡/å¢é‡æ„å»ºä¸­çš„ä¸€ç¯ã€‚"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"export const getInvalidator = () => {\n  if (!currentTask) log.enable && console.log('>>>>>no task')\n  // need to cache by another variable because currentTask is changing\n  const task = currentTask\n  return () => invalidate(task)\n}\n"}]}],"\n",["$","p",null,{"children":"ä¸‹ä¸€æ­¥ï¼Œè®©ç¼“å­˜å¤±æ•ˆå‡½æ•°ä¸æ–‡ä»¶ç›‘å¬å‡½æ•°è¿›è¡Œå…³è”ï¼Œå½“æ–‡ä»¶æ”¹åŠ¨æ—¶ï¼Œæ‰§è¡Œç¼“å­˜å¤±æ•ˆå‡½æ•°ã€‚"}],"\n",["$","p",null,{"children":["å€ŸåŠ©ã€ä»¥ filepath ä½œä¸º key çš„ç¼“å­˜ ",["$","code",null,{"children":"invalidatorCache"}]," ã€æ¥è®°å½•æ¯ä¸ªæ–‡ä»¶çš„ ",["$","code",null,{"children":"read"}]," æ„å»ºé˜¶æ®µçš„ç¼“å­˜å¤±æ•ˆå‡½æ•°ã€‚æ–‡ä»¶æ”¹åŠ¨åï¼Œé€šè¿‡ ",["$","code",null,{"children":"invalidatorCache"}]," æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜å¤±æ•ˆå‡½æ•°ï¼Œæ‰§è¡Œç¼“å­˜å¤±æ•ˆå‡½æ•°æ¥å®ç°ç›®æ ‡ã€‚"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"export const read = task('read', (entry) => {\n  const invalidator = getInvalidator()\n  // æ³¨å†Œå½“å‰æ–‡ä»¶çš„ç¼“å­˜å¤±æ•ˆå‡½æ•°\n  invalidatorCache.set(entry, invalidator)\n  return readFileSync(entry, 'utf8', (err) => {\n    console.error('>>>>>>>read error', err)\n  })\n})\n"}]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"watch(process.cwd(), { recursive: true }, (eventType, filename) => {\n  if (!filename) return\n  filename = resolve(filename)\n  // æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜å¤±æ•ˆå‡½æ•°\n  const invalidator = invalidatorCache.get(filename)\n  invalidator &&\n    setTimeout(() => {\n      invalidatorCache.delete(filename)\n      log.enable && console.time('file change')\n      // æ‰§è¡Œç¼“å­˜å¤±æ•ˆå‡½æ•°\n      invalidator()\n      log.enable && console.timeEnd('file change')\n    }, 100)\n})\n"}]}],"\n",["$","p",null,{"children":"é€šè¿‡ä»¥ä¸Šå‡ ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å³å¯åšåˆ° æ–‡ä»¶æ”¹åŠ¨ => ä½¿ç¼“å­˜å¤±æ•ˆ => å¢é‡æ„å»ºã€‚"}],"\n",["$","p",null,{"children":"ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ª demo æ¥è§£é‡Šä¸€ä¸‹å…¨é“¾è·¯"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"// test/index.js\nimport { foo as foo1 } from './1.js'\nimport { foo as foo2 } from './2.js'\nimport { foo as foo3 } from './3.js'\nimport { foo as foo4 } from './4.js'\nimport { foo as foo5 } from './5.js'\nimport { foo as foo6 } from './6.js'\nimport { foo as foo7 } from './7.js'\nimport { foo as foo8 } from './8.js'\nimport { foo as foo9 } from './9.js'\nimport { foo as foo10 } from './10.js'\nimport { foo as foo11 } from './11.js'\nimport { foo as foo12 } from './12.js'\n"}]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"ç¬¬ä¸€æ¬¡æ‰§è¡Œæ„å»ºè¿‡ç¨‹ï¼Œæµç¨‹å¦‚ä¸‹"}],"\n"]}],"\n",["$","img",null,{"src":"/assets/the-core-of-turbopack-explained/image-3.png","alt":"æ„å»ºè¿‡ç¨‹"}],"\n",["$","h4",null,{"children":["å½“ ",["$","code",null,{"children":"./1.js"}]," æ–‡ä»¶æ”¹åŠ¨æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["é‡è¯»å– ",["$","code",null,{"children":"./1.js"}]," æ–‡ä»¶ï¼Œå‘ç° ",["$","code",null,{"children":"task.result"}]," ä¸ä¹‹å‰ç»“æœä¸ä¸€è‡´ï¼Œæ›´æ–°ç¼“å­˜ï¼Œè¿›è¡Œå†’æ³¡ï¼Œæ‰§è¡Œçˆ¶çº§æ„å»ºé“¾"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"copy"}]," æ„å»ºé˜¶æ®µï¼Œ",["$","code",null,{"children":"writeFile"}]," è¾“å‡ºæ„å»ºç»“æœï¼Œ",["$","code",null,{"children":"task.result"}]," ä¸º undefinedï¼Œä¸ä¹‹å‰ç»“æœä¸€è‡´ï¼Œç»“æŸæ‰§è¡Œ"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"getImporter"}]," æ„å»ºé˜¶æ®µï¼Œ",["$","code",null,{"children":"task.result"}]," ä¸º [] ç©ºæ•°ç»„ï¼ŒJSON.stringify åï¼Œä¸ä¹‹å‰ç»“æœä¸€è‡´ï¼Œç»“æŸæ‰§è¡Œ"]}],"\n"]}],"\n",["$","h4",null,{"children":["å½“ ",["$","code",null,{"children":"index.js"}]," æ–‡ä»¶æ”¹åŠ¨ï¼Œå¦‚æ–°å¢ä¾èµ– ",["$","code",null,{"children":"import"}]," è¯­å¥"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"import { foo as foo14 } from \"./14.js\"`\n"}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["é‡è¯»å– ",["$","code",null,{"children":"./index.js"}]," æ–‡ä»¶ï¼Œå‘ç° ",["$","code",null,{"children":"task.result"}]," ä¸ä¹‹å‰ç»“æœä¸ä¸€è‡´ï¼Œæ›´æ–°ç¼“å­˜ï¼Œè¿›è¡Œå†’æ³¡ï¼Œæ‰§è¡Œçˆ¶çº§æ„å»ºé“¾"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"copy"}]," æ„å»ºé˜¶æ®µï¼Œ",["$","code",null,{"children":"writeFile"}]," è¾“å‡ºæ„å»ºç»“æœï¼Œ",["$","code",null,{"children":"task.result"}]," ä¸º undefinedï¼Œä¸ä¹‹å‰ç»“æœä¸€è‡´ï¼Œç»“æŸæ‰§è¡Œã€‚"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"getImporter"}]," æ„å»ºé˜¶æ®µï¼Œ",["$","code",null,{"children":"task.result"}]," æ•°ç»„æ–°å¢ä¸€é¡¹ï¼Œä¸ä¹‹å‰ç»“æœä¸ä¸€è‡´ï¼Œè¿›è¡Œå†’æ³¡ã€‚"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"./index.js"}]," çš„ ",["$","code",null,{"children":"copyGraph"}]," æ„å»ºé˜¶æ®µï¼Œ",["$","code",null,{"children":"./1.js"}]," è‡³ ",["$","code",null,{"children":"./13.js"}]," çš„æ„å»ºé˜¶æ®µçš†è¢«ç¼“å­˜ï¼Œä¸å†æ‰§è¡Œã€‚"]}],"\n",["$","li",null,{"children":["æ‰§è¡Œ ",["$","code",null,{"children":"./14.js"}]," çš„ ",["$","code",null,{"children":"copyGraph"}]," æ„å»ºé˜¶æ®µï¼Œæœªå‘½ä¸­ç¼“å­˜ï¼Œæ‰§è¡Œ ",["$","code",null,{"children":"copy"}]," ä¸ ",["$","code",null,{"children":"getImporter"}]," æ„å»ºé˜¶æ®µï¼Œå¹¶è¿›è¡Œ task ç¼“å­˜ã€‚"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"./index.js"}]," çš„ ",["$","code",null,{"children":"copyGraph"}]," æ„å»ºé˜¶æ®µçš„",["$","code",null,{"children":"task.result"}]," ä¸º undefinedï¼Œä¸ä¹‹å‰ç»“æœä¸€è‡´ï¼Œç»“æŸæ‰§è¡Œã€‚"]}],"\n"]}],"\n",["$","h2",null,{"children":"ç»“è¯­"}],"\n",["$","p",null,{"children":["æ¬¢è¿ ğŸ”— Fork æˆ– â¤ï¸ Star æœ¬ä»“åº“ ",["$","a",null,{"href":"https://github.com/haijie-x/the-core-of-turbopack-explained","children":"the-core-of-turbopack-explained"}]," å…±åŒæ¢è®¨ä¸å­¦ä¹ ã€‚"]}],"\n",["$","h2",null,{"children":"å‚è€ƒ"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"https://portal.gitnation.org/contents/the-core-of-turbopack-explained-live-coding"}],"\n",["$","li",null,{"children":"https://turbo.build/pack/docs/core-concepts"}],"\n"]}]]]}]
a:null
